<div class="container-fluid mt-4">
  <h2 class="mb-4">Quản lý đơn hàng</h2>

  <!-- Tìm kiếm -->

  <div class="row mb-4 align-items-center">
    <div class="col-md-8">
      <input type="text" class="form-control" placeholder="Tìm kiếm đơn hàng..." [(ngModel)]="keyword">
    </div>
    <div class="col-md-4 text-end">
      <button class="btn btn-primary" (click)="searchOrders()">Tìm kiếm</button>
    </div>
  </div>

  <!-- Bảng đơn hàng -->

  <div class="table-responsive">
    <table class="table table-bordered table-hover text-center">
      <thead class="table-light">
        <tr>
          <th>ID</th>
          <th>Người dùng</th>
          <th>Họ tên</th>
          <th>Email</th>
          <th>SĐT</th>
          <th>Địa chỉ</th>
          <th>Ghi chú</th>
          <th>Ngày đặt</th>
          <th>Trạng thái</th>
          <th>Tổng tiền</th>
          <th>Hành động</th>
        </tr>
      </thead>
      <tbody>
        @for(order of orders; track order.id) {
        <tr>
          <td>{{ order.id }}</td>
          <td>{{ order.user_id }}</td>
          <td>{{ order.fullname }}</td>
          <td>{{ order.email }}</td>
          <td>{{ order.phone_number }}</td>
          <td>{{ order.address }}</td>
          <td>{{ order.note }}</td>
          <td>{{ order.order_date | date:'dd/MM/yyyy' }}</td>
          <td>
            <span class="badge px-3 py-2" [ngClass]="{
              'bg-secondary': order.status === 'pending',
              'bg-warning text-dark': order.status === 'processing',
              'bg-info text-dark': order.status === 'shipped',
              'bg-success': order.status === 'delivered',
              'bg-danger': order.status === 'cancelled'
            }">
              {{
              order.status === 'pending' ? 'Chờ xác nhận' :
              order.status === 'processing' ? 'Đang xử lý' :
              order.status === 'shipped' ? 'Đã giao hàng' :
              order.status === 'delivered' ? 'Đã hoàn tất' :
              order.status === 'cancelled' ? 'Đã huỷ' : order.status
              }}
            </span>
          </td>

          <td>{{ order.total_money | currency: 'VND' : "symbol" }} </td>
          <td>
            <div class="d-flex justify-content-center gap-2">
              <button class="btn btn-sm btn-info" (click)="viewDetails(order)">Chi tiết</button>
              <button class="btn btn-sm btn-danger" (click)="deleteOrder(order.id)">Xoá</button>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>


  </div>

  <!-- Phân trang -->

  <div class="d-flex justify-content-center mt-3">
    <nav aria-label="Page navigation">
      <ul class="pagination mb-0">
        @if(currentPage > 1) {
        <li class="page-item">
          <a class="page-link" (click)="onPageChange(1)">Đầu</a>
        </li>
        }
        @for(page of visiblePages; track page) {
        <li class="page-item" [ngClass]="{'active': page === currentPage}">
          <a class="page-link" (click)="onPageChange(page)">{{ page }}</a>
        </li>
        }
        @if(currentPage < totalPages) { <li class="page-item">
          <li class="page-item">
            <a class="page-link" (click)="onPageChange(totalPages)">Cuối</a>
          </li>
          }
      </ul>
    </nav>
  </div>
</div>